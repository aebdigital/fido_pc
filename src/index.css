@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* Handle iPad/tablet virtual keyboard - ensure modals stay visible */
  html {
    height: 100%;
    height: -webkit-fill-available;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    min-height: 100vh;
    min-height: -webkit-fill-available;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply font-bold tracking-tight;
  }

  button {
    @apply font-semibold;
  }
}

.dark {
  color-scheme: dark;
}

.dark body {
  color: #ffffff;
}

/* Modal Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@keyframes slideInFromBottom {
  from {
    transform: translateY(16px) scale(0.95);
    opacity: 0;
  }

  to {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}

@keyframes slideInFromTop {
  from {
    transform: translateY(-8px);
    opacity: 0;
  }

  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes slideInFromBottomStagger {
  from {
    transform: translateY(8px);
    opacity: 0;
  }

  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes fadeOut {
  from {
    opacity: 1;
  }

  to {
    opacity: 0;
  }
}

@keyframes slideOutToBottom {
  from {
    transform: translateY(0) scale(1);
    opacity: 1;
  }

  to {
    transform: translateY(16px) scale(0.95);
    opacity: 0;
  }
}

@keyframes slideOutToTop {
  from {
    transform: translateY(0);
    opacity: 1;
  }

  to {
    transform: translateY(-8px);
    opacity: 0;
  }
}

/* Animation utility classes */
.animate-fade-in {
  animation: fadeIn 200ms ease-out;
}

.animate-fade-out {
  animation: fadeOut 200ms ease-out;
}

.animate-slide-in {
  animation: slideInFromBottom 300ms ease-out;
}

.animate-slide-out {
  animation: slideOutToBottom 300ms ease-out;
}

.animate-slide-in-top {
  animation: slideInFromTop 200ms ease-out;
}

.animate-slide-out-top {
  animation: slideOutToTop 200ms ease-out;
}

.animate-slide-in-stagger {
  animation: slideInFromBottomStagger 300ms ease-out;
}

/* Zoom in animation for lightbox */
@keyframes zoomIn {
  from {
    opacity: 0;
    transform: scale(0.85);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

.animate-zoom-in {
  animation: zoomIn 250ms cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Lightbox photo slide animations */
@keyframes fadeSlideIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes slideFromLeft {
  from {
    opacity: 0;
    transform: translateX(-30px) scale(0.98);
  }

  to {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

@keyframes slideFromRight {
  from {
    opacity: 0;
    transform: translateX(30px) scale(0.98);
  }

  to {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

.animate-fadeSlideIn {
  animation: fadeSlideIn 300ms ease-out;
}

.animate-slide-from-left {
  animation: slideFromLeft 300ms ease-out;
}

.animate-slide-from-right {
  animation: slideFromRight 300ms ease-out;
}

/* Custom Scrollbar */
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: #f3f4f6;
  border-radius: 3px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #9ca3af;
  border-radius: 3px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: #6b7280;
}

.dark .custom-scrollbar::-webkit-scrollbar-track {
  background: #374151;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb {
  background: #6b7280;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: #9ca3af;
}

/* Hide default number input arrows */
.hide-number-arrows::-webkit-outer-spin-button,
.hide-number-arrows::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.hide-number-arrows[type=number] {
  -moz-appearance: textfield;
  appearance: textfield;
}

/* Light mode shadow for cards, containers, and buttons */
/* Using :not(.dark) to target light mode only */
:root:not(.dark) .rounded-xl:not(input):not(textarea):not(select):not([class*="bg-transparent"]),
:root:not(.dark) .rounded-2xl:not(input):not(textarea):not(select):not([class*="bg-transparent"]),
:root:not(.dark) .rounded-lg:not(input):not(textarea):not(select):not([class*="bg-transparent"]),
:root:not(.dark) button:not([class*="bg-transparent"]):not([class*="text-gray-900"]):not([class*="font-bold"]),
:root:not(.dark) [class*="bg-white"]:not(button):not(input):not(textarea),
:root:not(.dark) [class*="bg-gray-100"]:not(button),
:root:not(.dark) [class*="bg-gray-200"]:not(button) {
  border: 1px solid rgb(229, 231, 235);
  box-shadow: rgba(255, 255, 255, 0.19) 0px 1px 2px inset, rgba(0, 0, 0, 0.19) 0px 1px 2px, rgba(0, 0, 0, 0.082) 0px 2px 4px;
}

/* ========== DARK MODE OVERRIDES ========== */
/* Override Tailwind dark blue colors to dark grey/almost black */

/* Main backgrounds - override bg-gray-900 to almost black */
.dark .bg-gray-900 {
  background-color: #0d0d0d !important;
}

/* Secondary backgrounds - override bg-gray-800 to dark grey */
.dark .bg-gray-800 {
  background-color: #1a1a1a !important;
}

/* Tertiary backgrounds - override bg-gray-700 */
.dark .bg-gray-700 {
  background-color: #252525 !important;
}

/* Cards and containers in dark mode - gradient background with top light effect */
.dark .rounded-xl:not(input):not(textarea):not(select),
.dark .rounded-2xl:not(input):not(textarea):not(select),
.dark .rounded-lg:not(input):not(textarea):not(select) {
  background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%) !important;
  border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
  box-shadow:
    inset 0 1px 0 0 rgba(255, 255, 255, 0.06),
    0 1px 3px rgba(0, 0, 0, 0.4),
    0 4px 6px rgba(0, 0, 0, 0.3) !important;
}

/* Allow borders to show on buttons in dark mode if explicitly defined */
.dark button.border,
.dark button[class*="border-"],
.dark button.border-2 {
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

/* Buttons in dark mode */
.dark button:not([class*="bg-transparent"]):not(.rounded-xl):not(.rounded-2xl):not(.rounded-lg) {
  background: linear-gradient(180deg, #2a2a2a 0%, #1f1f1f 100%) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-top-color: rgba(255, 255, 255, 0.15) !important;
  box-shadow:
    inset 0 1px 0 0 rgba(255, 255, 255, 0.06),
    0 1px 2px rgba(0, 0, 0, 0.3) !important;
}

/* Override specific dark bg colors used in components */
.dark [class*="dark:bg-gray-900"] {
  background-color: #0d0d0d !important;
}

.dark [class*="dark:bg-gray-800"] {
  background-color: #1a1a1a !important;
}

.dark [class*="dark:bg-gray-700"] {
  background-color: #252525 !important;
}

/* Sidebar specific styling */
.dark aside,
.dark nav {
  background-color: #0a0a0a !important;
}

/* Input fields - regular flat look, no gradient/shadow */
input,
textarea,
select {
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  /* Prevent auto-zoom on mobile/tablet browsers where font-size < 16px triggers zoom */
  font-size: 16px !important;
}

:root:not(.dark) input,
:root:not(.dark) textarea,
:root:not(.dark) select {
  background-color: #ffffff !important;
  border: 1px solid #d1d5db !important;
  box-shadow: none !important;
}

:root:not(.dark) input:focus,
:root:not(.dark) textarea:focus,
:root:not(.dark) select:focus {
  border-color: #3b82f6 !important;
  outline: 2px solid #3b82f6;
  outline-offset: -1px;
}

.dark input,
.dark textarea,
.dark select {
  background-color: #121212 !important;
  background: #121212 !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  box-shadow: none !important;
  color: #ffffff !important;
}

.dark input:focus,
.dark textarea:focus,
.dark select:focus {
  border-color: #60a5fa !important;
  outline: 2px solid #60a5fa;
  outline-offset: -1px;
}

/* Text that should be lighter in dark mode */
.dark .text-gray-600,
.dark .text-gray-500,
.dark .text-gray-400 {
  color: #a0a0a0 !important;
}

/* Icons and text that are too dark - make them lighter */
.dark svg.text-gray-600,
.dark svg.text-gray-500,
.dark svg.text-gray-400,
.dark [class*="dark:text-gray-400"],
.dark [class*="dark:text-gray-500"] {
  color: #b0b0b0 !important;
}

/* Active sidebar link text */
.dark .text-gray-900,
.dark [class*="dark:text-white"] {
  color: #ffffff !important;
}

/* Button text in dark mode - ensure readable */
.dark button:not(.text-blue-600):not(.text-red-600):not(.text-green-600),
.dark button .text-gray-900,
.dark button.text-gray-900,
.dark button[class*="dark:text-gray-900"],
.dark button .text-gray-800,
.dark button.text-gray-800 {
  color: #ffffff !important;
}

/* Save/action buttons text */
.dark button[class*="bg-gray-900"] span,
.dark button[class*="bg-gray-900"] {
  color: #ffffff !important;
}

/* Active toggle/selection states - background white, text dark */
/* Only target buttons that are SPECIFICALLY meant to be active selections */
.dark button.bg-white:not([class*="dark:bg-"]),
.dark button[class*="bg-white"]:not([class*="dark:bg-"]):not(.bg-transparent),
.dark a.bg-white:not([class*="dark:bg-"]):not(.bg-transparent) {
  background-color: #ffffff !important;
  background: #ffffff !important;
  color: #0d0d0d !important;
  border: none !important;
}

/* Specific fix for periods and selection buttons text */
.dark .bg-white.text-gray-900,
.dark [class*="dark:bg-white"][class*="dark:text-gray-900"] {
  color: #0d0d0d !important;
}

/* Price offer validity and similar active states */
.dark .bg-gray-900.text-white,
.dark [class*="bg-gray-900"][class*="text-white"] {
  color: #ffffff !important;
}

/* Icons in modals/popups should be white */
.dark .modal svg,
.dark [role="dialog"] svg,
.dark .fixed svg:not(.text-red-500):not(.text-green-500):not(.text-red-400) {
  color: #e0e0e0 !important;
}

/* Archive button icon and similar header icons */
.dark header svg,
.dark [class*="flex"][class*="items-center"][class*="gap"]>svg,
.dark button svg {
  color: #e0e0e0 !important;
}

/* Delete/trash icons should be red in dark mode */
.dark svg.text-red-500,
.dark svg.text-red-400,
.dark .text-red-500 svg,
.dark .text-red-400 svg,
.dark button:hover svg.text-gray-400,
.dark [class*="hover:text-red"] svg {
  color: #ef4444 !important;
}

/* Preserve green icons */
.dark svg.text-green-500,
.dark svg.text-green-400,
.dark .text-green-500 svg {
  color: #22c55e !important;
}

/* Project categories sidebar - inner shadow should be dark for white text */
.dark [class*="shadow-inner"],
.dark .shadow-inner {
  --tw-shadow: inset 0 2px 4px 0 rgb(0 0 0 / 0.3) !important;
  box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), inset 0 2px 4px 0 rgb(0 0 0 / 0.3) !important;
}

/* Dark mode scrollbar update */
.dark .custom-scrollbar::-webkit-scrollbar-track {
  background: #1a1a1a;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb {
  background: #3a3a3a;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: #4a4a4a;
}

/* Mobile bottom navigation links - remove global dark mode gradients */
.dark a.mobile-nav-link.rounded-2xl {
  background: transparent !important;
  background-image: none !important;
  border: none !important;
  border-top: none !important;
  box-shadow: none !important;
}

/* Icon-only buttons in dark mode - no border, transparent bg */
/* Only for navigation/close buttons that have ONLY an icon, no text, no bg color */
.dark button[class*="text-gray-600"][class*="hover:text-gray-900"]:not([class*="bg-"]):not([class*="rounded-2xl"]):not([class*="px-"]),
.dark button[class*="text-gray-400"][class*="hover:text-gray-600"]:not([class*="bg-"]):not([class*="rounded-2xl"]):not([class*="px-"]) {
  border: none !important;
  border-top: none !important;
  background: transparent !important;
  box-shadow: none !important;
}

/* Filter text buttons (year/status filters on Invoices) - no styling, just text */
.dark button[class*="text-sm"][class*="font-medium"]:not([class*="bg-"]):not([class*="rounded-2xl"]):not([class*="px-"]) {
  background: transparent !important;
  border: none !important;
  border-top: none !important;
  box-shadow: none !important;
}

/* Contractor dropdown button - no border */
.dark button[class*="flex"][class*="items-center"][class*="gap-2"]:not([class*="bg-"]):not([class*="rounded-2xl"]):not([class*="px-"]) {
  background: transparent !important;
  border: none !important;
  border-top: none !important;
  box-shadow: none !important;
}

/* Sidebar footer logout specific - no border/bg by default, but keep radius */
.dark aside .border-t button,
.dark nav+div.border-t button,
.dark .lg\:w-64 .border-t button {
  background: transparent !important;
  border: none !important;
  border-top: none !important;
  box-shadow: none !important;
}

/* Category selectors gradient overlay - dark in dark mode */
.dark .bg-gradient-to-t[class*="from-white"] {
  background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0.3) 50%, transparent 100%) !important;
}

/* Category selector cards in dark mode - dark inward shadow */
.dark button[class*="rounded-2xl"][class*="overflow-hidden"] .h-24,
.dark button[class*="rounded-2xl"][class*="overflow-hidden"] .h-56,
.dark button[class*="rounded-3xl"][class*="overflow-hidden"] {
  box-shadow: inset 0 -40px 40px -20px rgba(0, 0, 0, 0.7) !important;
}

/* Category text should be white in dark mode */
.dark button[class*="rounded-2xl"] h3,
.dark button[class*="rounded-3xl"] h3,
.dark button[class*="rounded-2xl"] span,
.dark button[class*="rounded-3xl"] span {
  color: #ffffff !important;
}

/* Active work item border - high priority to ensure visibility */
/* Light mode: black border */
.ring-2.ring-gray-900 {
  --tw-ring-color: rgb(17 24 39) !important;
  --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color) !important;
  --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color) !important;
  box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000) !important;
}

/* Dark mode: white border */
.dark .ring-2.dark\:ring-white {
  --tw-ring-color: rgb(255 255 255) !important;
  --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color) !important;
  --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color) !important;
  box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000) !important;
}

/* Mobile date input fixes - prevent overflow */
input[type="date"] {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  min-width: 0;
  max-width: 100%;
  box-sizing: border-box;
}

/* Ensure date picker icon doesn't cause overflow on mobile */
input[type="date"]::-webkit-calendar-picker-indicator {
  padding: 0;
  margin: 0;
}

/* Mobile-specific date input styling */
@media (max-width: 640px) {
  input[type="date"] {
    font-size: 16px;
    /* Prevents iOS zoom on focus */
    padding-right: 8px;
  }
}

/* Invoice modal inputs - ensure white text in dark mode */
.dark .invoice-input-dark {
  color: #ffffff !important;
  -webkit-text-fill-color: #ffffff !important;
  color-scheme: dark !important;
}

.dark .invoice-input-dark::-webkit-calendar-picker-indicator {
  filter: invert(1);
}

/* Light mode invoice inputs */
.invoice-input-dark {
  color: #111827 !important;
  -webkit-text-fill-color: #111827 !important;
}

/* Invoice modal active button states - white bg with dark text in dark mode */
.dark button.invoice-btn-active,
.dark div.invoice-btn-active,
.dark .invoice-btn-active {
  background: #ffffff !important;
  background-color: #ffffff !important;
  background-image: none !important;
  color: #111827 !important;
  border: none !important;
  border-top: none !important;
  box-shadow: none !important;
}

.dark button.invoice-btn-active span,
.dark div.invoice-btn-active span,
.dark .invoice-btn-active span {
  color: #111827 !important;
}

.dark button.invoice-btn-active input,
.dark div.invoice-btn-active input {
  color: #111827 !important;
  -webkit-text-fill-color: #111827 !important;
}

/* Invoice modal inactive button states in dark mode */
.dark button.invoice-btn-inactive,
.dark div.invoice-btn-inactive,
.dark .invoice-btn-inactive {
  background: #4b5563 !important;
  background-color: #4b5563 !important;
  background-image: none !important;
  color: #ffffff !important;
  border-top: none !important;
}

.dark button.invoice-btn-inactive span,
.dark div.invoice-btn-inactive span,
.dark .invoice-btn-inactive span {
  color: #ffffff !important;
}

.dark button.invoice-btn-inactive input,
.dark div.invoice-btn-inactive input {
  color: #ffffff !important;
  -webkit-text-fill-color: #ffffff !important;
}

/* iPad/Tablet virtual keyboard handling - ensure modals don't get hidden */
@supports (height: 100dvh) {
  .fixed.inset-0 {
    height: 100dvh;
    max-height: 100dvh;
  }
}

/* When virtual keyboard is open, adjust modal positioning */
@media (max-height: 600px) and (orientation: landscape),
       (max-height: 500px) {
  .fixed.inset-0 {
    align-items: flex-start !important;
    padding-top: 1rem !important;
  }

  .fixed.inset-0 > div {
    max-height: calc(100vh - 2rem) !important;
    max-height: calc(100dvh - 2rem) !important;
    overflow-y: auto !important;
  }
}

/* iPad-specific: when keyboard shows, use dynamic viewport */
@media (min-width: 768px) and (max-width: 1024px) {
  .fixed.inset-0 {
    height: 100dvh;
    height: -webkit-fill-available;
  }

  /* Ensure modal content scrolls when keyboard is visible */
  .fixed.inset-0 > div[class*="rounded-2xl"],
  .fixed.inset-0 > div[class*="rounded-xl"] {
    max-height: calc(100dvh - 2rem);
    overflow-y: auto;
  }
}